<!DOCTYPE html> 
<html lang="ko"> 
<head> 
    <meta charset="UTF-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> 
    <title>걸어서 지구 한바퀴 - 라이브 챌린지</title> 
    <script src="https://cdn.tailwindcss.com"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script> 
    <style> 
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Pretendard:wght@400;700;900&display=swap'); 
        body { 
            margin: 0; 
            /* 배경 이미지 설정 */
            background: linear-gradient(rgba(0, 5, 10, 0.7), rgba(0, 5, 10, 0.7)), url('countdown.jpg');
            background-size: cover;
            background-position: center;
            color: white; 
            font-family: 'Pretendard', sans-serif; 
            overflow: hidden; 
            height: 100dvh; 
            touch-action: none; 
        } 
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; } 
        .ui-overlay { position: relative; z-index: 10; pointer-events: none; height: 100%; display: flex; flex-direction: column; justify-content: space-between; padding: 1.5rem 1rem; } 
        .interactive { pointer-events: auto; } 
        .title-font { font-family: 'Black Han Sans', sans-serif; } 
        .glass { background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); } 
        
        @media (max-width: 768px) {
            .dist-text { font-size: 4rem !important; }
            .dist-fraction { font-size: 2.5rem !important; }
            #personal-stat-card { scale: 0.85; transform-origin: top right; }
        }

        /* 전체화면 버튼 스타일 */
        .fullscreen-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
            pointer-events: auto;
        }
    </style> 
</head> 
<body> 

    <div id="canvas-container"></div> 

    <div class="fullscreen-btn interactive" onclick="toggleFullScreen()" title="전체화면 보기">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
    </div>

    <div class="fixed top-4 left-4 z-20 scale-90 origin-top-left md:scale-100">
        <div class="glass px-4 py-2 rounded-2xl border-l-4 border-l-red-500">
            <p class="text-[9px] text-red-400 font-bold tracking-widest mb-0.5">COUNTDOWN</p>
            <div id="d-day-text" class="title-font text-2xl text-white italic">D-00</div>
        </div>
    </div>

    <div class="fixed top-4 right-4 z-20 flex flex-col items-end gap-2 scale-90 origin-top-right md:scale-100"> 
        <div class="glass p-3 rounded-2xl text-right min-w-[130px]"> 
            <p class="text-[9px] text-yellow-400/80 font-bold tracking-widest mb-1">전체 목표기록</p> 
            <div id="global-target-display" class="title-font text-lg text-white italic">0 km</div> 
        </div> 
        <div id="personal-stat-card" class="opacity-0 transform translate-x-10 transition-all duration-700"> 
            <div class="glass p-3 rounded-2xl border-r-4 border-r-yellow-400 text-right min-w-[160px]"> 
                <p class="text-yellow-400 font-black text-[9px] tracking-widest mb-1 uppercase">내 기록</p> 
                <div class="space-y-1"> 
                    <div class="flex items-baseline justify-end gap-1"> 
                        <span id="my-dist-text" class="title-font text-xl">0.00</span> 
                        <span class="text-[9px] text-slate-400">/ <span id="my-target-text">0</span> km</span> 
                    </div> 
                    <div class="flex items-center justify-end gap-2"> 
                        <span id="my-percent-text" class="text-[10px] font-black text-yellow-400 italic">0%</span> 
                        <div class="w-16 h-1 bg-white/10 rounded-full overflow-hidden"> 
                            <div id="my-progress-bar" class="h-full bg-yellow-400" style="width: 0%"></div> 
                        </div> 
                    </div> 
                </div> 
            </div> 
        </div> 
    </div> 

    <div class="ui-overlay"> 
        <div class="text-center pt-24 md:pt-10"> 
            <div class="flex flex-col items-center justify-center gap-1 mb-1">
                <p class="text-yellow-400 text-sm md:text-xl font-bold tracking-[0.3em] title-font">누적 거리</p>
                <span class="text-[9px] md:text-sm text-white/50 font-bold">(지구 둘레 40,075km)</span>
            </div>
            <div class="flex flex-col items-center"> 
                <div id="dist-container" class="title-font text-6xl md:text-9xl tracking-tighter flex items-baseline dist-text">
                    <span id="dist-integer">0</span>
                    <span id="dist-fraction" class="text-3xl md:text-7xl">.0</span>
                    <span id="dist-unit" class="text-3xl md:text-7xl ml-1 italic text-slate-700">km</span>
                </div> 
                <div class="mt-1 md:mt-4"> 
                    <div id="percent-text" class="text-2xl md:text-4xl font-black text-white">0.00%</div> 
                    <div class="w-40 md:w-64 h-1.5 bg-white/10 rounded-full mt-2 mx-auto overflow-hidden"> 
                        <div id="global-progress-bar" class="h-full bg-yellow-400 shadow-[0_0_15px_#fbbf24]" style="width: 0%"></div> 
                    </div> 
                </div> 
            </div> 
        </div> 

        <div class="w-full max-w-xs mx-auto pb-16 px-4"> 
            <button onclick="openLoginModal()" class="interactive w-full py-4 bg-white text-black rounded-2xl font-black text-lg shadow-2xl active:scale-95 transition-transform"> 
                기록 추가하기 
            </button> 
        </div> 
    </div> 

    <div id="modal-backdrop" class="fixed inset-0 z-50 hidden flex items-center justify-center p-6 bg-black/90 backdrop-blur-xl">
        </div>

    <script>
        // 전체화면 토글 함수
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`전체화면 오류: ${err.message}`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // 3D 및 기존 로직 (이전 버전의 스크립트를 그대로 사용하되, 궤적 고정 로직 유지)
        let scene, camera, renderer, globe, marker, controls, pathTube; 
        const EARTH_CIRCUMFERENCE = 40075;  
        const GLOBE_RADIUS = 2; 
        const PATH_RADIUS = 2.05; 

        window.appData = { users: {}, totalKm: 0, totalGoal: 0 };
        let visualData = { totalKm: 0, totalGoal: 0, personalDist: 0, personalTarget: 0 };
        let currentUserId = null; 

        function init3D() { 
            scene = new THREE.Scene(); 
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000); 
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); 
            renderer.setSize(window.innerWidth, window.innerHeight); 
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); 
            document.getElementById('canvas-container').appendChild(renderer.domElement); 

            scene.add(new THREE.AmbientLight(0xffffff, 1.2)); 
            const sunLight = new THREE.DirectionalLight(0xffffff, 1.5); 
            sunLight.position.set(5, 3, 5); 
            scene.add(sunLight); 

            const textureLoader = new THREE.TextureLoader(); 
            const earthTexture = textureLoader.load('https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg'); 
            
            globe = new THREE.Mesh( 
                new THREE.SphereGeometry(GLOBE_RADIUS, 64, 64),  
                new THREE.MeshStandardMaterial({ map: earthTexture, roughness: 0.5, metalness: 0.2 }) 
            ); 
            scene.add(globe); 

            marker = new THREE.Group(); 
            // 마커 생성 및 globe 추가 로직 동일...
            globe.add(marker); 

            camera.position.z = 6; 
            controls = new THREE.OrbitControls(camera, renderer.domElement); 
            controls.enableDamping = true; controls.enableZoom = false; 

            animate(); 
        }

        // [이전 단계의 모든 JS 함수 - renderPath, updateVisuals, Firebase 관련 등 - 동일하게 유지]
        // ... (생략된 JS 부분은 이전 답변의 코드를 그대로 붙여넣으시면 됩니다)

        function animate() { 
            requestAnimationFrame(animate); 
            if(globe) globe.rotation.y += 0.001; 
            if(controls) controls.update(); 
            if(renderer) renderer.render(scene, camera); 
        } 

        window.addEventListener('resize', () => { 
            camera.aspect = window.innerWidth / window.innerHeight; 
            camera.updateProjectionMatrix(); 
            renderer.setSize(window.innerWidth, window.innerHeight); 
        }); 

        init3D();
    </script>
    
    </body> 
</html>
